<!DOCTYPE html>
<html>
<head>
  <title>Customer Database</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
    }
    .content {
      padding: 20px;
      flex-grow: 1;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid black;
      padding: 10px;
    }
    .edit-btn, .delete-btn {
      margin-right: 5px;
    }
    .form-section {
      margin-bottom: 30px;
    }
  </style>
</head>
<body>
  <div class="content">
    <h2>{% if request.form.get('action') == 'edit' %}Edit Customer{% else %}Add New Customer{% endif %}</h2>
    
    <!-- Unified form for Add/Edit -->
    <form method="POST" class="form-section">
      <input type="hidden" name="action" value="{{ 'edit' if request.form.get('action') == 'edit' else 'add' }}">
      <input type="hidden" name="id" value="{{ request.form.get('id', '') }}">
      
      <input type="text" name="mobile" placeholder="Mobile Number" required
             value="{{ request.form.get('mobile', '') }}"><br><br>
             
      <input type="text" name="product" placeholder="Product Purchased" required
             value="{{ request.form.get('product', '') }}"><br><br>
             
      <input type="date" name="date" required
             value="{{ request.form.get('date', '') }}"><br><br>
             
      <button type="submit">{{ 'Update' if request.form.get('action') == 'edit' else 'Add Customer' }}</button>
    </form>

    <h2>Customer Records</h2>
    <table>
      <tr>
        <th>ID</th>
        <th>Mobile</th>
        <th>Product</th>
        <th>Purchase Date</th>
        <th>Actions</th>
      </tr>
      {% for cust in customers %}
      <tr>
        <td>{{ cust[0] }}</td>
        <td>{{ cust[1] }}</td>
        <td>{{ cust[2] }}</td>
        <td>{{ cust[3] }}</td>
        <td>
          <!-- Edit: repopulates the form using POST -->
          <form method="POST" style="display:inline;">
            <input type="hidden" name="action" value="edit">
            <input type="hidden" name="id" value="{{ cust[0] }}">
            <input type="hidden" name="mobile" value="{{ cust[1] }}">
            <input type="hidden" name="product" value="{{ cust[2] }}">
            <input type="hidden" name="date" value="{{ cust[3] }}">
            <button class="edit-btn" type="submit">Edit</button>
          </form>

          <!-- Delete with JS confirmation -->
          <form method="POST" action="{{ url_for('delete_customer', customer_id=cust[0]) }}" style="display:inline;" onsubmit="return confirmDelete();">
            <button class="delete-btn" type="submit">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </table>

    <script>
      function confirmDelete() {
        return confirm("Are you sure you want to delete this data record?");
      }
    </script>
  </div>
</body>
</html>
